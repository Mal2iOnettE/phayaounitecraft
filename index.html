<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checking...</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div style="text-align: center; margin-top: 50px; font-family: sans-serif;">
        <h2 id="msg">กำลังตรวจสอบสิทธิ์...</h2>
        <p id="err-log" style="color: red;"></p>
    </div>

    <script>
        async function runLiff() {
            const msg = document.getElementById('msg');
            const errLog = document.getElementById('err-log');
            
            try {
                // ขั้นตอนที่ 1: Init
                msg.innerText = "กำลังเชื่อมต่อ LINE SDK...";
                await liff.init({ liffId: "2008782558-90JkUWGA" });
                
                // ขั้นตอนที่ 2: Login
                if (!liff.isLoggedIn()) {
                    msg.innerText = "กรุณารอ... กำลังพาไปหน้า Login";
                    liff.login();
                    return;
                }
                
                // ขั้นตอนที่ 3: ดึงข้อมูล Profile
                msg.innerText = "กำลังดึงข้อมูล User ID...";
                const profile = await liff.getProfile();
                const userId = profile.userId;
                https://docs.google.com/forms/d/e/1FAIpQLSejp6s2Cv4pRYOq0QYqWAdWM8U27-hlwoeGKMVQh2uSFwnKyg/viewform?usp=dialog
                if (userId) {
                    const formId = "1FAIpQLSejp6s2Cv4pRYOq0QYqWAdWM8U27-hlwoeGKMVQh2uSFwnKyg";
                    const entryId = "entry.1515544011"; // มั่นใจว่าเลขนี้ถูกต้องตามวิธี Pre-filled link
                    const finalUrl = `https://docs.google.com/forms/d/e/${formId}/viewform?usp=pp_url&${entryId}=${userId}`;
                    
                    msg.innerText = "สำเร็จ! กำลังไปที่หน้าแบบฟอร์ม...";
                    window.location.replace(finalUrl);
                }
            } catch (error) {
                msg.innerText = "❌ เกิดข้อผิดพลาด";
                errLog.innerText = error.code + " : " + error.message;
            }
        }
        runLiff();
    </script>
</body>
</html>
